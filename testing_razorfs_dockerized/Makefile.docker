# RAZOR Filesystem Docker Operations
# Use: make -f Makefile.docker [target]

.PHONY: docker-build docker-test-fuse docker-test-kernel docker-dev docker-clean docker-help

# Build Docker images
docker-build:
	@echo "Building RAZOR filesystem Docker images..."
	docker-compose build

# Test FUSE implementation (safe)
docker-test-fuse:
	@echo "Testing FUSE implementation in Docker..."
	@mkdir -p /tmp/razorfs-docker-test
	docker-compose run --rm razorfs-fuse
	@rm -rf /tmp/razorfs-docker-test

# Test kernel module (requires privileged)
docker-test-kernel:
	@echo "WARNING: This test requires privileged Docker and may affect your system!"
	@read -p "Continue? (y/N): " confirm && [ "$$confirm" = "y" ] || exit 1
	docker-compose run --rm razorfs-kernel

# Start development environment
docker-dev:
	@echo "Starting RAZOR filesystem development environment..."
	docker-compose run --rm razorfs-dev

# Build both components in Docker
docker-build-all:
	@echo "Building both FUSE and kernel components..."
	docker-compose run --rm razorfs-builder

# Clean Docker resources
docker-clean:
	@echo "Cleaning Docker resources..."
	docker-compose down --remove-orphans --rmi all --volumes

# Show help
docker-help:
	@echo "RAZOR Filesystem Docker Makefile"
	@echo ""
	@echo "Available targets:"
	@echo "  docker-build       - Build Docker images"
	@echo "  docker-test-fuse   - Test FUSE implementation (safe)"
	@echo "  docker-test-kernel - Test kernel module (dangerous)"
	@echo "  docker-dev         - Start development container"
	@echo "  docker-build-all   - Build both components"
	@echo "  docker-clean       - Clean Docker resources"
	@echo "  docker-help        - Show this help"
	@echo ""
	@echo "Quick start:"
	@echo "  make -f Makefile.docker docker-build"
	@echo "  make -f Makefile.docker docker-test-fuse"

# Default target
help: docker-help